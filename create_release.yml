create-release:
  needs:
  - placeholder
  runs-on: ubuntu-latest
  permissions:
    contents: write
  steps:
  - name: Download all artifacts
    uses: actions/download-artifact@v4
    with:
      path: artifacts
  - name: List downloaded artifacts
    run: ls -R artifacts/
  - name: Package Windows artifacts
    run: |-
      if [ -d "artifacts/tracy-windows" ]; then
        cd artifacts/tracy-windows
        zip -r ../../tracy-windows.zip ./*
        cd ../..
        echo "Created tracy-windows.zip"
      else
        echo "No Windows artifacts found"
      fi
  - name: Package macOS artifacts
    run: |-
      if [ -d "artifacts/tracy-macos" ]; then
        tar czf tracy-macos.tar.gz -C artifacts tracy-macos
        echo "Created tracy-macos.tar.gz"
      else
        echo "No macOS artifacts found"
      fi
  - name: Package Linux artifacts
    run: |-
      if [ -d "artifacts/tracy-linux" ]; then
        tar czf tracy-linux.tar.gz -C artifacts tracy-linux
        echo "Created tracy-linux.tar.gz"
      else
        echo "No Linux artifacts found"
      fi
  - name: List created packages
    run: ls -lh *.zip *.tar.gz 2>/dev/null || echo "No packages created"
  - name: Create Release
    uses: softprops/action-gh-release@v2
    with:
      name: Tracy ${{ github.ref_name }}
      target_commitish: ${{ github.sha }}
      body: Prebuilt Tracy binaries for ${{ github.ref_name }} from https://github.com/wolfpld/tracy
      files: |-
        *.zip
        *.tar.gz
      fail_on_unmatched_files: true
